(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{q61i:function(t,e,i){"use strict";i.r(e),i.d(e,"FeedbuzzModule",function(){return At});var n=i("jXWH"),c=i("fXoL"),a=i("lxpx"),r=i("sYmb");const o=t=>{const e=t.get("repetitionStatus").value,i=t.get("metricValues"),n=/^[0-9 ]+[,.]?[0-9]+$|^[0-9]+$/;if(!e){if(i)for(let t=0;t<i.length;t++){const e=i.at(t).get("value");if(e.value){if(!n.test(e.value))return e.setErrors({notNumerical:!0}),{notNumerical:!0}}else e.setErrors(null)}return null}if(i)for(let c=0;c<i.length;c++){const t=i.at(c);if(!t.value.value)return t.get("value").setErrors({required:!0}),{missingMetricValue:!0};if(!n.test(t.value.value))return t.get("value").setErrors({notNumerical:!0}),{notNumerical:!0}}return null};var s=i("3Pt+"),l=i("LRne"),u=i("3E0/"),b=i("vkgz");class p{constructor(t,e,i,n,c){this.opened=t,this.message=e,this.actionText=i,this.action=n,this.closed=c}}var d=i("7dP1"),m=i("Cs2V"),h=function(t){return t.toDo="TO_DO",t.done="DONE",t.canceled="CANCELED",t.notDone="NOT_DONE",t}({});let g=(()=>{class t{constructor(){}repetitionStatusToBoolean(t){switch(t){case h.canceled:return!1;case h.toDo:return null;case h.done:return!0;case h.notDone:return!1;default:return t}}booleanToRepetitionStatus(t){switch(t){case!1:return h.canceled;case null:return h.toDo;case!0:return h.done;default:return t}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=c.Ob({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var f=i("cp1x"),v=i("AytR"),S=i("tk/3");let x=(()=>{class t{constructor(t,e){this.http=t,this.habitStackService=e}updateRepetition(t,e,i){const n=v.a.backend.baseURL+"/habit-stack-feedbuzz/repetition";return t.content&&(t.content=t.content.trim()),this.http.patch(n,t).pipe(Object(b.a)(t=>{const n=this.habitStackService.getCurrentHabitStacksFeedbuzz();n[e].progressions[i].repetition=this.transformRepetition(n[e].progressions[i].repetition,t),this.habitStackService.setHabitStacksFeedbuzz(n)}))}transformRepetition(t,e){t.content=e.content,t.repetitionStatus=e.repetitionStatus;for(let i=0;i<t.metrics.length;i++)t.metrics[i].value=e.metricValues[i].value;return t}}return t.\u0275fac=function(e){return new(e||t)(c.fc(S.b),c.fc(m.a))},t.\u0275prov=c.Ob({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var F=i("WJ2q"),I=i("T3mI"),X=i("ofXK"),Y=i("Wp6s"),k=i("Zfm5"),y=i("bTqV"),C=i("STbY"),w=i("NFeN"),O=i("7EHt"),P=i("znSr"),R=i("bSwM");const Q=["*"];let T=(()=>{class t{constructor(){this.tape=[null,!0,!1]}onChange(t){}onTouched(){}writeValue(t){this.value=t||this.tape[0]}setDisabledState(t){this.disabled=t}next(){this.onChange(this.value=this.tape[(this.tape.indexOf(this.value)+1)%this.tape.length]),this.onTouched()}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Mb({type:t,selectors:[["app-tri-state-checkbox"]],inputs:{tape:"tape"},features:[c.Eb([{provide:s.m,useExisting:Object(c.Y)(()=>t),multi:!0},{provide:R.a,useValue:{clickAction:"noop"}}])],ngContentSelectors:Q,decls:2,vars:4,consts:[["appClickStopPropagation","",3,"ngModel","disabled","indeterminate","color","click"]],template:function(t,e){1&t&&(c.uc(),c.Yb(0,"mat-checkbox",0),c.jc("click",function(){return e.next()}),c.tc(1),c.Xb()),2&t&&c.vc("ngModel",e.value)("disabled",e.disabled)("indeterminate",!1===e.value)("color",!1===e.value?"warn":"accent")},directives:[R.b,k.a,s.o,s.r],styles:[".mat-checkbox-checked .mat-checkbox-background,.mat-checkbox-indeterminate .mat-checkbox-background,.mat-checkbox .mat-checkbox-frame{transform:scale(2)}"],encapsulation:2}),t})();var z=i("kmnG"),E=i("qFsG"),H=i("2Vo4");let $=(()=>{class t{constructor(t){this.http=t,this.picturesForm=new H.a(null),this.picturesForm$=this.picturesForm.asObservable()}setHeadlinePicture(t,e,i){return this.http.patch(`${v.a.backend.baseURL}/${i?"habit-stack-feedbuzz/repetition":"publication"}/headline-picture?publicationId=${e}`,t)}deletePicture(t,e,i){return this.http.delete(`${v.a.backend.baseURL}/${i?"habit-stack-feedbuzz/repetition":"publication"}/picture?publicationId=${e}&pictureId=${t.id}`)}addPublicationPictures(t,e,i,n){const c=`${v.a.backend.baseURL}/${n?"habit-stack-feedbuzz/repetition":"publication"}/pictures`,a=new FormData;return a.append("publicationId",e),null!==i&&a.append("headlinePictureName",i),t.forEach(t=>a.append("files[]",t)),this.http.post(c,a)}setPicturesForm(t){this.picturesForm.next(t)}}return t.\u0275fac=function(e){return new(e||t)(c.fc(S.b))},t.\u0275prov=c.Ob({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var N=i("wSAv");const L=["usefulSwiper"];function M(t,e){if(1&t&&(c.Yb(0,"button",16),c.Yb(1,"mat-icon",17),c.Qc(2,"more_vert"),c.Xb(),c.Xb()),2&t){c.nc();const t=c.Ec(4);c.vc("matMenuTriggerFor",t)}}function j(t,e){if(1&t){const t=c.Zb();c.Yb(0,"button",15),c.jc("click",function(){c.Hc(t);const e=c.nc().$implicit;return c.nc().setPincipalPicture(e)}),c.Yb(1,"mat-icon"),c.Qc(2,"photo_camera"),c.Xb(),c.Yb(3,"span"),c.Qc(4),c.oc(5,"translate"),c.Xb(),c.Xb()}2&t&&(c.Fb(4),c.Rc(c.pc(5,1,"shared.components.publication-carousel.menu.setHeadlinePicture")))}function D(t,e){1&t&&(c.Yb(0,"button",18),c.Yb(1,"span"),c.Qc(2),c.oc(3,"translate"),c.Xb(),c.Xb()),2&t&&(c.Fb(2),c.Rc(c.pc(3,1,"shared.components.publication-carousel.menu.headlinePicture")))}function _(t,e){if(1&t){const t=c.Zb();c.Yb(0,"div",9),c.Tb(1,"img",10),c.Oc(2,M,3,1,"button",11),c.Yb(3,"mat-menu",null,12),c.Oc(5,j,6,3,"button",13),c.Oc(6,D,4,3,"button",14),c.Yb(7,"button",15),c.jc("click",function(){c.Hc(t);const i=e.$implicit,n=e.index;return c.nc().deletePicture(i,n)}),c.Yb(8,"mat-icon"),c.Qc(9,"delete"),c.Xb(),c.Yb(10,"span"),c.Qc(11),c.oc(12,"translate"),c.Xb(),c.Xb(),c.Xb(),c.Xb()}if(2&t){const t=e.$implicit,i=e.first,n=c.nc();c.Fb(1),c.yc("src","",n.pictureDisplayingService.srcPrefix,"",t.imageFile,"",c.Jc),c.Fb(1),c.vc("ngIf",null==n.pictures?null:n.pictures.isEditable),c.Fb(3),c.vc("ngIf",!i),c.Fb(1),c.vc("ngIf",i),c.Fb(5),c.Rc(c.pc(12,6,"actions.Delete"))}}let V=(()=>{class t{constructor(t,e,i,n,c){this.publicationPicturesService=t,this.pictureDisplayingService=e,this.habitStackService=i,this.translationService=n,this.translate=c,this.isRepetitionType=!1,this.imgs=[],this.config={pagination:{el:".swiper-pagination",clickable:!0},autoHeight:!0,allowTouchMove:!0,autoplay:!1,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},loop:!0}}ngOnInit(){this.initImgs(),this.updateLang()}ngOnDestroy(){this.pictureSub&&this.pictureSub.unsubscribe(),this.langSub.unsubscribe()}setPincipalPicture(t){this.pictureSub=this.publicationPicturesService.setHeadlinePicture(t,this.publicationId,this.isRepetitionType).subscribe(t=>{null!=this.habitIndex&&null!=this.repetitionIndex&&this.isRepetitionType&&this.habitStackService.updateHabitStacksFeedbuzz(t,this.habitIndex,this.repetitionIndex)})}deletePicture(t,e){this.usefulSwiper.swiper.removeSlide(e),this.pictureSub=this.publicationPicturesService.deletePicture(t,this.publicationId,this.isRepetitionType).subscribe(t=>{this.habitIndex&&this.repetitionIndex&&this.isRepetitionType&&this.habitStackService.updateHabitStacksFeedbuzz(t,this.habitIndex,this.repetitionIndex)})}initImgs(){this.imgs.push(this.pictures.headlinePicture),this.imgs.push(...this.pictures.otherPictures)}updateLang(){this.translate.setDefaultLang(this.translationService.defaultLang),this.langSub=this.translationService.currentLang$.subscribe(t=>this.translate.use(t))}}return t.\u0275fac=function(e){return new(e||t)(c.Sb($),c.Sb(f.a),c.Sb(m.a),c.Sb(a.a),c.Sb(r.d))},t.\u0275cmp=c.Mb({type:t,selectors:[["app-publication-carousel"]],viewQuery:function(t,e){if(1&t&&c.Vc(L,1),2&t){let t;c.Dc(t=c.kc())&&(e.usefulSwiper=t.first)}},inputs:{habitIndex:"habitIndex",repetitionIndex:"repetitionIndex",publicationId:"publicationId",isRepetitionType:"isRepetitionType",pictures:"pictures"},decls:9,vars:2,consts:[[1,"d-flex","justify-content-center"],[1,"dimension"],[3,"config"],["usefulSwiper",""],[1,"swiper-wrapper"],["class","swiper-slide d-flex justify-content-center",4,"ngFor","ngForOf"],[1,"swiper-pagination"],[1,"swiper-button-prev","left-swiper"],[1,"swiper-button-next","right-swiper"],[1,"swiper-slide","d-flex","justify-content-center"],[1,"img-fluid","ml-2","mt-2","img-centered",3,"src"],["mat-icon-button","","class","pp-button",3,"matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",4,"ngIf"],["mat-menu-item","",3,"click"],["mat-icon-button","",1,"pp-button",3,"matMenuTriggerFor"],[1,"text-primary"],["mat-menu-item",""]],template:function(t,e){1&t&&(c.Yb(0,"div",0),c.Yb(1,"div",1),c.Yb(2,"swiper",2,3),c.Yb(4,"div",4),c.Oc(5,_,13,8,"div",5),c.Xb(),c.Tb(6,"div",6),c.Tb(7,"div",7),c.Tb(8,"div",8),c.Xb(),c.Xb(),c.Xb()),2&t&&(c.Fb(2),c.vc("config",e.config),c.Fb(3),c.vc("ngForOf",e.imgs))},directives:[N.b,X.l,X.m,C.a,C.b,w.a,y.a,C.d],pipes:[r.c],styles:[".img-centered[_ngcontent-%COMP%]{padding:.25rem;background-color:#fff;border:1px solid #dee2e6;width:90vw;height:62vw;object-fit:cover}@media screen and (min-width:540px){.img-centered[_ngcontent-%COMP%]{width:510px;height:350px}}.dimension[_ngcontent-%COMP%]{width:90vw;height:62vw}@media screen and (min-width:540px){.dimension[_ngcontent-%COMP%]{width:510px;height:350px}}.swiper-slide[_ngcontent-%COMP%]{left:1rem!important}.swiper-button-prev[_ngcontent-%COMP%]{left:2rem!important}.pp-button[_ngcontent-%COMP%]{position:relative;top:1rem;left:-3rem;z-index:10;background-color:hsla(0,0%,96.1%,.5490196078431373)}.right-swiper[_ngcontent-%COMP%]:after{position:relative;left:-1rem;z-index:10}"]}),t})();var A=i("0IaG"),U=i("7ZcW");function G(t,e){1&t&&(c.Yb(0,"mat-error"),c.Qc(1),c.oc(2,"translate"),c.Xb()),2&t&&(c.Fb(1),c.Sc(" ",c.pc(2,1,"shared.components.publication-picture-upload-dialog.error.required")," "))}function q(t,e){if(1&t&&(c.Yb(0,"mat-error"),c.Qc(1),c.oc(2,"translate"),c.oc(3,"byteFormat"),c.oc(4,"byteFormat"),c.Xb()),2&t){const t=c.nc();c.Fb(1),c.Uc(" ",c.pc(2,3,"shared.components.publication-picture-upload-dialog.error.maxContentSize")," ",c.pc(3,5,null==t.pictures?null:t.pictures.getError("maxContentSize").maxSize)," (",c.pc(4,7,null==t.pictures?null:t.pictures.getError("maxContentSize").actualSize),"). ")}}function Z(t,e){1&t&&(c.Yb(0,"mat-icon",19),c.Qc(1," photo_camera "),c.Xb())}const W=function(t){return{"headline-picture-selected bg-primary":t}};function J(t,e){if(1&t){const t=c.Zb();c.Yb(0,"div",16),c.Oc(1,Z,2,0,"mat-icon",17),c.Yb(2,"img",18),c.jc("click",function(){return c.Hc(t),c.nc().setAsHeadlinePicture(null)}),c.Xb(),c.Xb()}if(2&t){const t=c.nc();c.Fb(1),c.vc("ngIf",null===t.headlineIndex.value),c.Fb(1),c.yc("src","",t.pictureDisplayingService.srcPrefix,"",t.data.profilePicture.imageFile,"",c.Jc),c.vc("ngClass",c.Ac(4,W,null===t.headlineIndex.value))}}function B(t,e){1&t&&(c.Yb(0,"mat-icon",19),c.Qc(1," photo_camera "),c.Xb())}function K(t,e){if(1&t){const t=c.Zb();c.Yb(0,"div",16),c.Oc(1,B,2,0,"mat-icon",17),c.Yb(2,"img",18),c.jc("click",function(){c.Hc(t);const i=e.index;return c.nc().setAsHeadlinePicture(i)}),c.Xb(),c.Xb()}if(2&t){const t=e.$implicit,i=e.index,n=c.nc();c.Fb(1),c.vc("ngIf",i===n.headlineIndex.value),c.Fb(1),c.vc("src",t,c.Jc)("ngClass",c.Ac(3,W,i===n.headlineIndex.value))}}let tt=(()=>{class t{constructor(t,e,i,n,c,a){this.data=t,this.publicationPicturesService=e,this.pictureDisplayingService=i,this.habitStackService=n,this.translationService=c,this.translate=a,this.maxSize=104857600,this.imgURLs=[],this.imgNames=[]}get pictures(){return this.picturesForm.get("pictures")}get headlineIndex(){return this.picturesForm.get("headlineIndex")}ngOnInit(){this.getForm(),this.updateLang()}ngOnDestroy(){this.formSub.unsubscribe(),this.langSub.unsubscribe()}savePictures(){this.publicationPicturesService.addPublicationPictures(this.pictures.value.files,this.data.publicationId,this.headlineIndex.value?this.imgNames[this.headlineIndex.value]:null,this.data.isRepetitionType).subscribe(t=>{null!=this.data.habitIndex&&null!=this.data.repetitionIndex&&this.data.isRepetitionType&&this.habitStackService.updateHabitStacksFeedbuzz(t,this.data.habitIndex,this.data.repetitionIndex)})}updateImgURL(t){const e=this.pictureDisplayingService.detectFiles(t);this.imgNames=e.imgNames,this.imgURLs=e.imgURLs}setAsHeadlinePicture(t){this.picturesForm.patchValue({headlineIndex:t})}getForm(){this.formSub=this.publicationPicturesService.picturesForm$.subscribe(t=>{this.picturesForm=t,this.updateImgURL(this.pictures.value.files)})}updateLang(){this.translate.setDefaultLang(this.translationService.defaultLang),this.langSub=this.translationService.currentLang$.subscribe(t=>this.translate.use(t))}}return t.\u0275fac=function(e){return new(e||t)(c.Sb(A.a),c.Sb($),c.Sb(f.a),c.Sb(m.a),c.Sb(a.a),c.Sb(r.d))},t.\u0275cmp=c.Mb({type:t,selectors:[["app-publication-pictures-upload-dialog"]],decls:24,vars:17,consts:[["mat-dialog-title",""],[1,"mat-typography"],[3,"formGroup"],[1,"button-icon-wrapper-sm","rounded-circle","d-flex","justify-content-center","align-items-center","m-auto",3,"click"],["mat-icon-button","",3,"click"],["button",""],[1,"icon-display-sm","mat-text-primary"],["formControlName","pictures","multiple","",1,"d-none",3,"accept","change"],["fileInput",""],[1,"my-3","text-center"],[4,"ngIf"],["class","d-inline picture-wrapper",4,"ngIf"],["class","d-inline picture-wrapper",4,"ngFor","ngForOf"],["align","end"],["mat-button","","mat-dialog-close","",1,"color-grey","text-white"],["mat-button","","color","primary",3,"disabled","mat-dialog-close","click"],[1,"d-inline","picture-wrapper"],["class","legend text-primary rounded",4,"ngIf"],[1,"picture-thumbnail","ml-2","mt-2",3,"src","ngClass","click"],[1,"legend","text-primary","rounded"]],template:function(t,e){if(1&t){const t=c.Zb();c.Yb(0,"h2",0),c.Qc(1),c.oc(2,"translate"),c.Xb(),c.Yb(3,"mat-dialog-content",1),c.Yb(4,"form",2),c.Yb(5,"div",3),c.jc("click",function(){c.Hc(t);const e=c.Ec(7),i=c.Ec(11);return e.focus(),i.open()}),c.Yb(6,"button",4,5),c.jc("click",function(){return c.Hc(t),c.Ec(11).open()}),c.Yb(8,"mat-icon",6),c.Qc(9,"add_photo_alternate"),c.Xb(),c.Yb(10,"ngx-mat-file-input",7,8),c.jc("change",function(t){return e.updateImgURL(null==t||null==t.target?null:t.target.files)}),c.Xb(),c.Xb(),c.Xb(),c.Yb(12,"div",9),c.Oc(13,G,3,3,"mat-error",10),c.Oc(14,q,5,9,"mat-error",10),c.Xb(),c.Xb(),c.Oc(15,J,3,6,"div",11),c.Oc(16,K,3,5,"div",12),c.Xb(),c.Yb(17,"mat-dialog-actions",13),c.Yb(18,"button",14),c.Qc(19),c.oc(20,"translate"),c.Xb(),c.Yb(21,"button",15),c.jc("click",function(){return e.savePictures()}),c.Qc(22),c.oc(23,"translate"),c.Xb(),c.Xb()}2&t&&(c.Fb(1),c.Rc(c.pc(2,11,"shared.components.publication-picture-upload-dialog.title")),c.Fb(3),c.vc("formGroup",e.picturesForm),c.Fb(6),c.vc("accept","image/*"),c.Fb(3),c.vc("ngIf",e.pictures.hasError("required")&&e.pictures.touched),c.Fb(1),c.vc("ngIf",e.pictures.hasError("maxContentSize")),c.Fb(1),c.vc("ngIf",e.data.profilePicture),c.Fb(1),c.vc("ngForOf",e.imgURLs),c.Fb(3),c.Rc(c.pc(20,13,"actions.BACK")),c.Fb(2),c.vc("disabled",e.pictures.invalid)("mat-dialog-close",!0),c.Fb(1),c.Rc(c.pc(23,15,"actions.SEND")))},directives:[A.i,A.f,s.w,s.p,s.h,y.a,w.a,U.b,s.o,s.g,X.m,X.l,A.c,A.d,z.b,X.k,P.a],pipes:[r.c,U.a],styles:[".picture-wrapper[_ngcontent-%COMP%]{position:relative;width:120px}.legend[_ngcontent-%COMP%]{position:absolute;top:-42px;left:100px;background-color:#f5f5f5;z-index:20}.picture-thumbnail[_ngcontent-%COMP%]{padding:.25rem;background-color:#fff;border:1px solid #dee2e6;width:120px;height:120px;object-fit:cover}"]}),t})();var et=i("uToo");let it=(()=>{class t{constructor(t,e,i,n,c,a){this.fb=t,this.publicationPicturesService=e,this.dialog=i,this.translationService=n,this.translate=c,this.layoutService=a,this.isRepetitionType=!1,this.maxSize=104857600,this.imgURLs=[]}get pictures(){return this.picturesForm.get("pictures")}ngOnInit(){this.initForm(),this.updateLang(),this.getLargerScreen()}ngOnDestroy(){this.langSub.unsubscribe(),this.screenSub.unsubscribe()}openDialog(){const t=new A.e;this.publicationPicturesService.setPicturesForm(this.picturesForm),t.data={publicationId:this.publicationId,headlinePicture:this.headlinePicture,isRepetitionType:this.isRepetitionType,habitIndex:this.habitIndex,repetitionIndex:this.repetitionIndex},this.isLargerScreen?(t.minWidth=600,t.width="60vw"):(t.maxWidth="95vw",t.width="95vw"),this.dialog.open(tt,t).afterClosed().subscribe(t=>{})}initForm(){this.picturesForm=this.fb.group({pictures:[void 0,[s.u.required,U.c.maxContentSize(this.maxSize)]],headlineIndex:[null,[]]})}updateLang(){this.translate.setDefaultLang(this.translationService.defaultLang),this.langSub=this.translationService.currentLang$.subscribe(t=>this.translate.use(t))}getLargerScreen(){this.screenSub=this.layoutService.onLargerScreen$.subscribe(t=>this.isLargerScreen=t)}}return t.\u0275fac=function(e){return new(e||t)(c.Sb(s.d),c.Sb($),c.Sb(A.b),c.Sb(a.a),c.Sb(r.d),c.Sb(et.a))},t.\u0275cmp=c.Mb({type:t,selectors:[["app-publication-pictures-upload"]],inputs:{habitIndex:"habitIndex",repetitionIndex:"repetitionIndex",isRepetitionType:"isRepetitionType",publicationId:"publicationId",headlinePicture:"headlinePicture"},decls:8,vars:2,consts:[[3,"formGroup"],["appClickStopPropagation","",1,"button-icon-wrapper-sm","rounded-circle","d-flex","justify-content-center","align-items-center","mat-dark-elevation-z4",3,"click"],["mat-icon-button",""],["button",""],[1,"icon-display-sm","mat-text-primary"],["formControlName","pictures","multiple","",1,"d-none",3,"accept","change"],["fileInput",""]],template:function(t,e){if(1&t){const t=c.Zb();c.Yb(0,"form",0),c.Yb(1,"div",1),c.jc("click",function(){c.Hc(t);const e=c.Ec(3),i=c.Ec(7);return e.focus(),i.open()}),c.Yb(2,"button",2,3),c.Yb(4,"mat-icon",4),c.Qc(5,"add_photo_alternate"),c.Xb(),c.Yb(6,"ngx-mat-file-input",5,6),c.jc("change",function(){return e.openDialog()}),c.Xb(),c.Xb(),c.Xb(),c.Xb()}2&t&&(c.vc("formGroup",e.picturesForm),c.Fb(6),c.vc("accept","image/*"))},directives:[s.w,s.p,s.h,k.a,y.a,w.a,U.b,s.o,s.g],styles:[""]}),t})();var nt=i("MutI"),ct=i("FKr1"),at=i("f0Cb");function rt(t,e){if(1&t&&(c.Yb(0,"span",29),c.Qc(1),c.oc(2,"date"),c.Xb()),2&t){const t=c.nc(3).$implicit;c.Fb(1),c.Sc(" ",c.qc(2,1,t.time,"shortTime")," ")}}function ot(t,e){if(1&t&&(c.Yb(0,"span",29),c.Qc(1),c.oc(2,"date"),c.Xb()),2&t){const t=c.nc(3).$implicit;c.Fb(1),c.Sc(" ",c.qc(2,1,t.time,"HH:mm")," ")}}function st(t,e){if(1&t&&(c.Yb(0,"div",31),c.Yb(1,"mat-icon",32),c.Qc(2,"speed"),c.Xb(),c.Yb(3,"span",29),c.Qc(4),c.Xb(),c.Xb()),2&t){const t=e.ngIf;c.Fb(4),c.Rc(t)}}function lt(t,e){if(1&t&&(c.Yb(0,"mat-card-subtitle"),c.Yb(1,"mat-icon",16),c.Qc(2,"schedule"),c.Xb(),c.Oc(3,rt,3,4,"span",27),c.Oc(4,ot,3,4,"span",27),c.Yb(5,"span",28),c.Yb(6,"mat-icon",16),c.Qc(7,"place"),c.Xb(),c.Yb(8,"span",29),c.Qc(9),c.Xb(),c.Xb(),c.Oc(10,st,5,1,"div",30),c.Xb()),2&t){const t=c.nc().$implicit,e=c.nc(3);c.Fb(3),c.vc("ngIf",e.translationService.isEnglish()),c.Fb(1),c.vc("ngIf",!e.translationService.isEnglish()),c.Fb(5),c.Rc(null==t||null==t.location?null:t.location.name),c.Fb(1),c.vc("ngIf",null==t?null:t.gatewayHabit)}}function ut(t,e){if(1&t&&(c.Yb(0,"mat-card-subtitle"),c.Yb(1,"mat-icon",32),c.Qc(2,"speed"),c.Xb(),c.Yb(3,"span",29),c.Qc(4),c.Xb(),c.Xb()),2&t){const t=e.ngIf;c.Fb(4),c.Rc(t)}}function bt(t,e){if(1&t&&(c.Yb(0,"button",33),c.Yb(1,"mat-icon",7),c.Qc(2,"more_horiz"),c.Xb(),c.Xb()),2&t){c.nc();const t=c.Ec(9);c.vc("matMenuTriggerFor",t)}}const pt=function(t){return{"d-none":t}};function dt(t,e){if(1&t&&(c.Yb(0,"pre",34),c.Qc(1),c.Xb()),2&t){const t=e.ngIf,i=c.nc().index,n=c.nc().index,a=c.nc(2);c.vc("ngClass",c.Ac(2,pt,a.editContent[n][i])),c.Fb(1),c.Sc("              ",t,"\n            ")}}function mt(t,e){if(1&t&&(c.Yb(0,"mat-error"),c.Qc(1),c.oc(2,"translate"),c.Xb()),2&t){const t=c.nc().$implicit;c.Fb(1),c.Tc("",null==t?null:t.metricName,"\xa0",c.pc(2,2,"protected.feedbuzz.habit-stack-list.required")," ")}}function ht(t,e){1&t&&(c.Yb(0,"mat-error"),c.Qc(1),c.oc(2,"translate"),c.Xb()),2&t&&(c.Fb(1),c.Sc(" ",c.pc(2,1,"protected.feedbuzz.habit-stack-list.pleaseNumber")," "))}function gt(t,e){if(1&t&&(c.Wb(0,39),c.Yb(1,"mat-form-field",40),c.Yb(2,"mat-label"),c.Qc(3),c.Xb(),c.Tb(4,"input",41),c.Yb(5,"span",42),c.Qc(6),c.Xb(),c.Oc(7,mt,3,4,"mat-error",12),c.Oc(8,ht,3,3,"mat-error",12),c.Xb(),c.Vb()),2&t){const t=e.$implicit,i=e.index,n=c.nc(2).index,a=c.nc().index,r=c.nc(2);let o=null,s=null;c.Fb(1),c.Lc("width",r.getMetricFieldWidth(t),"px"),c.vc("formGroupName",i),c.Fb(2),c.Rc(null==t?null:t.metricName),c.Fb(3),c.Rc(null==t?null:t.metricUnit),c.Fb(1),c.vc("ngIf",null==(o=r.metricValueValue(a,n,i))||null==o.errors?null:o.errors.required),c.Fb(1),c.vc("ngIf",null==(s=r.metricValueValue(a,n,i))||null==s.errors?null:s.errors.notNumerical)}}function ft(t,e){if(1&t&&(c.Yb(0,"div",35),c.Yb(1,"div",36),c.Tb(2,"app-tri-state-checkbox",37),c.Xb(),c.Oc(3,gt,9,7,"ng-container",38),c.Xb()),2&t){const t=c.nc().$implicit;c.Fb(3),c.vc("ngForOf",null==t||null==t.repetition?null:t.repetition.metrics)}}const vt=function(t,e){return{"mt-5":t,"mt-3":e}};function St(t,e){if(1&t&&(c.Yb(0,"div",43),c.Tb(1,"app-tri-state-checkbox",44),c.Xb()),2&t){const t=c.nc(),e=t.index,i=t.$implicit,n=c.nc().index,a=c.nc(2);c.vc("ngClass",c.Bc(1,vt,!a.editContent[n][e]&&(null==i||null==i.repetition?null:i.repetition.content),a.editContent[n][e]||!(null!=i&&null!=i.repetition&&i.repetition.content)))}}function xt(t,e){if(1&t&&c.Tb(0,"app-publication-carousel",47),2&t){const t=c.nc().ngIf,e=c.nc(),i=e.$implicit,n=e.index,a=c.nc(),r=a.$implicit,o=a.index,s=c.nc(2);c.vc("pictures",s.pictureDisplayingService.pictureListToPictures(t,(null==r?null:r.userId)==(null==s.user?null:s.user.id)))("publicationId",null==i||null==i.repetition?null:i.repetition.id)("isRepetitionType",!0)("habitIndex",o)("repetitionIndex",n)}}function Ft(t,e){if(1&t&&(c.Yb(0,"div",45),c.Oc(1,xt,1,5,"app-publication-carousel",46),c.Xb()),2&t){const t=e.ngIf;c.Fb(1),c.vc("ngIf",(null==t?null:t.length)>0)}}function It(t,e){if(1&t&&(c.Yb(0,"div",48),c.Tb(1,"app-publication-pictures-upload",49),c.Xb()),2&t){const t=e.ngIf,i=c.nc(),n=i.$implicit,a=i.index,r=c.nc().index,o=c.nc(2);c.Fb(1),c.vc("publicationId",null==n||null==n.repetition?null:n.repetition.id)("headlinePicture",o.pictureDisplayingService.getHeadlinePicture(t))("isRepetitionType",!0)("habitIndex",r)("repetitionIndex",a)}}const Xt=function(t,e,i){return{"mat-color-primary text-white":t,"color-grey":e,"d-none":i}};function Yt(t,e){if(1&t){const t=c.Zb();c.Yb(0,"div",50),c.Yb(1,"mat-form-field",51),c.Yb(2,"mat-label"),c.Qc(3,"Commentaire"),c.Xb(),c.Tb(4,"textarea",52),c.Xb(),c.Yb(5,"div",53),c.Yb(6,"button",54),c.jc("click",function(){c.Hc(t);const e=c.nc().index,i=c.nc().index;return c.nc(2).submitRepetition(i,e)}),c.Qc(7),c.oc(8,"translate"),c.Xb(),c.Xb(),c.Xb()}if(2&t){const t=c.nc(),e=t.index,i=t.$implicit,n=c.nc().index,a=c.nc(2);c.Fb(1),c.vc("ngClass",c.Ac(6,pt,!a.repetitionStatus(n,e)||(null==i||null==i.repetition?null:i.repetition.content)&&!a.editContent[n][e])),c.Fb(5),c.vc("disabled",!(a.repetition(n,e).valid&&!a.repetition(n,e).untouched)||null)("ngClass",c.Cc(8,Xt,a.repetition(n,e).valid&&a.repetition(n,e).touched,!a.repetition(n,e).valid||a.repetition(n,e).untouched,a.repetition(n,e).untouched)),c.Fb(1),c.Sc(" ",c.pc(8,4,"actions.UPDATE")," ")}}function kt(t,e){if(1&t&&(c.Yb(0,"mat-expansion-panel",13),c.Yb(1,"mat-expansion-panel-header",16),c.Yb(2,"mat-panel-title"),c.Yb(3,"mat-icon",55),c.Qc(4,"psychology"),c.Xb(),c.Yb(5,"span",56),c.Qc(6),c.Xb(),c.Xb(),c.Xb(),c.Qc(7),c.Xb()),2&t){const t=c.nc().$implicit;c.Fb(6),c.Rc(null==t||null==t.conditioningStep?null:t.conditioningStep.description),c.Fb(1),c.Sc(" ",null==t||null==t.conditioningStep||null==t.conditioningStep.location?null:t.conditioningStep.location.name," ")}}function yt(t,e){1&t&&(c.Yb(0,"mat-expansion-panel",57),c.Yb(1,"mat-expansion-panel-header",16),c.Yb(2,"mat-panel-title"),c.Yb(3,"mat-icon",55),c.Qc(4,"psychology"),c.Xb(),c.Yb(5,"span",56),c.Qc(6),c.oc(7,"translate"),c.Xb(),c.Xb(),c.Xb(),c.Xb()),2&t&&(c.Fb(6),c.Rc(c.pc(7,1,"protected.feedbuzz.habit-stack-list.condition-step")))}function Ct(t,e){1&t&&(c.Yb(0,"span"),c.Qc(1,",\xa0"),c.Xb())}function wt(t,e){if(1&t&&(c.Yb(0,"span",56),c.Qc(1),c.Oc(2,Ct,2,0,"span",12),c.Xb()),2&t){const t=e.$implicit,i=e.last,n=c.nc(2).$implicit;c.Fb(1),c.Sc(" ",t.name,""),c.Fb(1),c.vc("ngIf",!i&&(null==n||null==n.identities?null:n.identities.length)>1)}}function Ot(t,e){1&t&&(c.Yb(0,"span"),c.Qc(1," ,\xa0"),c.Xb())}function Pt(t,e){if(1&t&&(c.Yb(0,"span"),c.Qc(1),c.Oc(2,Ot,2,0,"span",12),c.Xb()),2&t){const t=e.$implicit,i=e.last,n=c.nc(2).$implicit,a=c.nc(3);let r=null;c.Fb(1),c.Sc(" ",t,""),c.Fb(1),c.vc("ngIf",!i&&(null==(r=a.identityToCategories(null==n?null:n.identities))?null:r.length)>1)}}function Rt(t,e){if(1&t&&(c.Yb(0,"mat-expansion-panel",13),c.Yb(1,"mat-expansion-panel-header",16),c.Yb(2,"mat-panel-title"),c.Yb(3,"mat-icon",55),c.Qc(4,"how_to_reg"),c.Xb(),c.Oc(5,wt,3,2,"span",58),c.Xb(),c.Xb(),c.Oc(6,Pt,3,2,"span",59),c.Xb()),2&t){const t=c.nc().$implicit,e=c.nc(3);c.Fb(5),c.vc("ngForOf",null==t?null:t.identities),c.Fb(1),c.vc("ngForOf",e.identityToCategories(null==t?null:t.identities))}}function Qt(t,e){1&t&&(c.Yb(0,"mat-expansion-panel",57),c.Yb(1,"mat-expansion-panel-header",16),c.Yb(2,"mat-panel-title"),c.Yb(3,"mat-icon",55),c.Qc(4,"how_to_reg"),c.Xb(),c.Yb(5,"span",56),c.Qc(6),c.oc(7,"translate"),c.Xb(),c.Xb(),c.Xb(),c.Xb()),2&t&&(c.Fb(6),c.Sc("",c.pc(7,1,"protected.feedbuzz.habit-stack-list.identities")," "))}function Tt(t,e){if(1&t&&(c.Yb(0,"mat-expansion-panel",13),c.Yb(1,"mat-expansion-panel-header",16),c.Yb(2,"mat-panel-title"),c.Yb(3,"mat-icon",55),c.Qc(4,"emoji_events"),c.Xb(),c.Yb(5,"span",56),c.Qc(6),c.Xb(),c.Xb(),c.Xb(),c.Qc(7),c.Xb()),2&t){const t=c.nc().$implicit;c.Fb(6),c.Rc(null==t||null==t.reward?null:t.reward.description),c.Fb(1),c.Sc(" ",t.reward.location.name," ")}}function zt(t,e){1&t&&(c.Yb(0,"mat-expansion-panel",57),c.Yb(1,"mat-expansion-panel-header",16),c.Yb(2,"mat-panel-title"),c.Yb(3,"mat-icon",55),c.Qc(4,"emoji_events"),c.Xb(),c.Yb(5,"span",56),c.Qc(6),c.oc(7,"translate"),c.Xb(),c.Xb(),c.Xb(),c.Xb()),2&t&&(c.Fb(6),c.Rc(c.pc(7,1,"protected.feedbuzz.habit-stack-list.reward")))}function Et(t,e){if(1&t&&(c.Yb(0,"mat-expansion-panel",13),c.Yb(1,"mat-expansion-panel-header",16),c.Yb(2,"mat-panel-title"),c.Yb(3,"mat-icon",55),c.Qc(4,"visibility"),c.Xb(),c.Yb(5,"span",56),c.Qc(6),c.Xb(),c.Xb(),c.Xb(),c.Yb(7,"mat-list"),c.Yb(8,"mat-list-item",16),c.Yb(9,"mat-icon",60),c.Qc(10,"done"),c.Xb(),c.Yb(11,"div",61),c.Qc(12),c.Xb(),c.Xb(),c.Yb(13,"mat-list-item",16),c.Yb(14,"mat-icon",60),c.Qc(15,"close"),c.Xb(),c.Yb(16,"div",61),c.Qc(17),c.Xb(),c.Xb(),c.Xb(),c.Xb()),2&t){const t=c.nc().$implicit;c.Fb(6),c.Rc(null==t||null==t.habitContract?null:t.habitContract.accountablePartnerName),c.Fb(6),c.Rc(null==t||null==t.habitContract?null:t.habitContract.commitment),c.Fb(5),c.Rc(null==t||null==t.habitContract?null:t.habitContract.punishment)}}function Ht(t,e){if(1&t){const t=c.Zb();c.Yb(0,"mat-card",13),c.Yb(1,"mat-card-header"),c.Yb(2,"mat-card-title",14),c.Qc(3),c.Xb(),c.Oc(4,lt,11,4,"mat-card-subtitle",12),c.Oc(5,ut,5,1,"mat-card-subtitle",12),c.Xb(),c.Yb(6,"mat-card-content",4),c.Oc(7,bt,3,1,"button",15),c.Yb(8,"mat-menu",16,8),c.Yb(10,"button",9),c.jc("click",function(){c.Hc(t);const i=e.index,n=c.nc().index;return c.nc(2).setContentAsEditable(n,i)}),c.Yb(11,"mat-icon"),c.Qc(12,"edit"),c.Xb(),c.Yb(13,"span"),c.Qc(14),c.oc(15,"translate"),c.Xb(),c.Xb(),c.Yb(16,"button",9),c.jc("click",function(){c.Hc(t);const i=e.index,n=c.nc().index;return c.nc(2).deleteContent(n,i)}),c.Yb(17,"mat-icon"),c.Qc(18,"delete"),c.Xb(),c.Yb(19,"span"),c.Qc(20),c.oc(21,"translate"),c.Xb(),c.Xb(),c.Xb(),c.Oc(22,dt,2,4,"pre",17),c.Oc(23,ft,4,1,"div",18),c.Oc(24,St,2,4,"div",19),c.Oc(25,Ft,2,1,"div",20),c.Oc(26,It,2,5,"div",21),c.Oc(27,Yt,9,12,"div",22),c.Yb(28,"mat-accordion",23),c.Oc(29,kt,8,2,"mat-expansion-panel",24),c.Oc(30,yt,8,3,"mat-expansion-panel",25),c.Oc(31,Rt,7,2,"mat-expansion-panel",24),c.Oc(32,Qt,8,3,"mat-expansion-panel",25),c.Oc(33,Tt,8,2,"mat-expansion-panel",24),c.Oc(34,zt,8,3,"mat-expansion-panel",25),c.Oc(35,Et,18,3,"mat-expansion-panel",24),c.Xb(),c.Xb(),c.Yb(36,"mat-card-actions",16),c.Yb(37,"button",26),c.Qc(38),c.oc(39,"translate"),c.Xb(),c.Yb(40,"button",26),c.Qc(41),c.oc(42,"translate"),c.Xb(),c.Xb(),c.Xb()}if(2&t){const t=e.$implicit,i=e.first,n=e.index,a=c.nc(),r=a.index,o=a.$implicit,s=c.nc(2);c.Fb(3),c.Rc(null==t?null:t.habitName),c.Fb(1),c.vc("ngIf",i),c.Fb(1),c.vc("ngIf",!i&&(null==t?null:t.gatewayHabit)),c.Fb(1),c.vc("formGroupName",n),c.Fb(1),c.vc("ngIf",null==t||null==t.repetition?null:t.repetition.content),c.Fb(7),c.Rc(c.pc(15,22,"actions.Edit")),c.Fb(6),c.Rc(c.pc(21,24,"actions.Delete")),c.Fb(2),c.vc("ngIf",null==t||null==t.repetition?null:t.repetition.content),c.Fb(1),c.vc("ngIf",(null==t||null==t.repetition||null==t.repetition.metrics?null:t.repetition.metrics.length)>0&&s.metricValues(r,n).length==(null==t||null==t.repetition||null==t.repetition.metrics?null:t.repetition.metrics.length)),c.Fb(1),c.vc("ngIf",0==(null==t||null==t.repetition||null==t.repetition.metrics?null:t.repetition.metrics.length)&&(null==o?null:o.userId)==(null==s.user?null:s.user.id)),c.Fb(1),c.vc("ngIf",s.repetitionPictures(r,n)),c.Fb(1),c.vc("ngIf",(null==o?null:o.userId)==(null==s.user?null:s.user.id)&&s.repetitionPictures(r,n)),c.Fb(1),c.vc("ngIf",(null==o?null:o.userId)==(null==s.user?null:s.user.id)),c.Fb(2),c.vc("ngIf",null==t?null:t.conditioningStep),c.Fb(1),c.vc("ngIf",!(null!=t&&t.conditioningStep)),c.Fb(1),c.vc("ngIf",null==t?null:t.identities),c.Fb(1),c.vc("ngIf",!(null!=t&&t.identities)),c.Fb(1),c.vc("ngIf",null==t?null:t.reward),c.Fb(1),c.vc("ngIf",!(null!=t&&t.reward)),c.Fb(1),c.vc("ngIf",null==t?null:t.habitContract),c.Fb(3),c.Rc(c.pc(39,26,"actions.LIKE")),c.Fb(3),c.Rc(c.pc(42,28,"actions.SHARE"))}}function $t(t,e){1&t&&c.Tb(0,"mat-divider")}function Nt(t,e){if(1&t){const t=c.Zb();c.Yb(0,"div",3),c.Yb(1,"mat-card",4),c.Yb(2,"mat-card-header"),c.Yb(3,"mat-card-title",5),c.Qc(4),c.Yb(5,"button",6),c.Yb(6,"mat-icon",7),c.Qc(7,"more_horiz"),c.Xb(),c.Xb(),c.Yb(8,"mat-menu",null,8),c.Yb(10,"button",9),c.jc("click",function(){c.Hc(t);const i=e.$implicit;return c.nc(2).editHabitStack(i)}),c.Yb(11,"mat-icon"),c.Qc(12,"edit"),c.Xb(),c.Yb(13,"span"),c.Qc(14),c.oc(15,"translate"),c.Xb(),c.Xb(),c.Yb(16,"button",9),c.jc("click",function(){c.Hc(t);const i=e.$implicit;return c.nc(2).deleteHabitStack(i)}),c.Yb(17,"mat-icon"),c.Qc(18,"delete"),c.Xb(),c.Yb(19,"span"),c.Qc(20),c.oc(21,"translate"),c.Xb(),c.Xb(),c.Xb(),c.Xb(),c.Xb(),c.Yb(22,"mat-card-content",10),c.Oc(23,Ht,43,30,"mat-card",11),c.Xb(),c.Xb(),c.Oc(24,$t,1,0,"mat-divider",12),c.Xb()}if(2&t){const t=e.$implicit,i=e.last,n=e.index,a=c.Ec(9);c.Fb(1),c.vc("formGroupName",n),c.Fb(3),c.Sc(" ",null==t?null:t.habitStackName," "),c.Fb(1),c.vc("matMenuTriggerFor",a),c.Fb(9),c.Rc(c.pc(15,7,"actions.Edit")),c.Fb(6),c.Rc(c.pc(21,9,"actions.Delete")),c.Fb(3),c.vc("ngForOf",null==t?null:t.progressions),c.Fb(1),c.vc("ngIf",!i)}}function Lt(t,e){if(1&t&&(c.Yb(0,"form",1),c.Oc(1,Nt,25,11,"div",2),c.Xb()),2&t){const t=c.nc();c.vc("formGroup",t.habitsForm),c.Fb(1),c.vc("ngForOf",t.habitStacks)}}let Mt=(()=>{class t{constructor(t,e,i,n,c,a,r,o,s,l){this.authService=t,this.habitStackService=e,this.fb=i,this.statusConverterService=n,this.pictureDisplayingService=c,this.repetitionService=a,this.identityService=r,this.bannerContentService=o,this.translationService=s,this.translate=l,this.editContentPrefilled=!1,this.editContent=[],this.isPrefilled=!1,this.viewReady=!1,this.contentSent=!1}get habits(){var t;return null===(t=this.habitsForm)||void 0===t?void 0:t.get("habits")}repetitions(t){var e,i;return null===(i=null===(e=this.habits)||void 0===e?void 0:e.at(t))||void 0===i?void 0:i.get("repetitions")}repetition(t,e){var i;return null===(i=this.repetitions(t))||void 0===i?void 0:i.at(e)}repetitionPictures(t,e){var i,n,c;return null===(c=null===(n=null===(i=this.habitStacks[t])||void 0===i?void 0:i.progressions[e])||void 0===n?void 0:n.repetition)||void 0===c?void 0:c.publicationPictures}repetitionStatus(t,e){var i,n;return null===(n=null===(i=this.repetition(t,e))||void 0===i?void 0:i.get("repetitionStatus"))||void 0===n?void 0:n.value}metricValues(t,e){var i,n;return null===(n=null===(i=this.repetitions(t))||void 0===i?void 0:i.at(e))||void 0===n?void 0:n.get("metricValues")}metricValueValue(t,e,i){var n,c;return null===(c=null===(n=this.metricValues(t,e))||void 0===n?void 0:n.at(i))||void 0===c?void 0:c.get("value")}ngOnInit(){this.user=this.authService.currentUser}ngOnDestroy(){this.stackSub.unsubscribe(),this.repetitionSub&&this.repetitionSub.unsubscribe(),this.habitsForm&&(this.habitsForm.removeControl("habits"),this.isPrefilled=!1),this.noHabitTransSub&&this.noHabitTransSub.unsubscribe(),this.createHabitTransSub&&this.createHabitTransSub.unsubscribe()}ngAfterViewInit(){Object(l.a)(!0).pipe(Object(u.a)(1),Object(b.a)(t=>this.getHabitStackFeedbuzz())).subscribe(t=>{this.viewReady||this.prefillForm(this.habitStacks)})}submitRepetition(t,e){const i=this.metricValues(t,e).length;if(!this.repetitionStatus(t,e)&&i>0)for(let c=0;c<i;c++)this.metricValueValue(t,e,c).reset();let n=this.repetition(t,e);n.patchValue({repetitionStatus:this.statusConverterService.booleanToRepetitionStatus(n.get("repetitionStatus").value)}),this.repetitionSub=this.repetitionService.updateRepetition(n.value,t,e).subscribe(i=>{this.setContentAsNotEditable(t,e),this.repetition(t,e).markAsUntouched()})}setContentAsEditable(t,e){this.editContent[t][e]=!0}deleteContent(t,e){this.repetition(t,e).patchValue({content:""}),this.submitRepetition(t,e)}setContentAsNotEditable(t,e){this.editContent[t][e]=!1}editHabitStack(t){}deleteHabitStack(t){}identityToCategories(t){var e;return[...new Set(null===(e=this.identityService.identitiesToCategories(t))||void 0===e?void 0:e.map(t=>this.translationService.translateIdentityCategory(t)))]}getMetricFieldWidth(t){var e,i;return 7.4*((null===(e=null==t?void 0:t.metricName)||void 0===e?void 0:e.length)+(null===(i=null==t?void 0:t.metricUnit)||void 0===i?void 0:i.length)+3)+16}getHabitStackFeedbuzz(){this.habitStackService.setHabitStacksFeedbuzz(),this.stackSub=this.habitStackService.habitStacksFeedbuzz$.subscribe(t=>{this.isPrefilled=!1,this.habitStacks=t,this.prefillForm(t),this.initEditContent(),0!=t.length||this.contentSent?t.length>0&&this.bannerContentService.setContent(null):this.noHabitTransSub=this.translate.get("protected.feedbuzz.habit-stack-list.NoHabit").subscribe(t=>{this.createHabitTransSub=this.translate.get("actions.CREATE_HABIT").subscribe(e=>{this.bannerContentService.setContent(new p(!0,t,e,"createHabit",!1)),this.contentSent=!0})})})}initForm(){this.habitsForm=this.fb.group({habits:this.fb.array([])})}prefillForm(t){var e;t&&t.length&&(this.initForm(),t.forEach(t=>{const e=this.fb.group({id:[t.id]}),i=this.fb.array([]);null==t||t.progressions.forEach(t=>{var e,n,c,a;const r=this.fb.group({id:[null===(e=null==t?void 0:t.repetition)||void 0===e?void 0:e.id],content:[null===(n=null==t?void 0:t.repetition)||void 0===n?void 0:n.content],repetitionStatus:this.statusConverterService.repetitionStatusToBoolean(null===(c=null==t?void 0:t.repetition)||void 0===c?void 0:c.repetitionStatus)},{validators:o}),l=this.fb.array([]);null===(a=null==t?void 0:t.repetition)||void 0===a||a.metrics.forEach(t=>{const e=this.fb.group({metricId:[null==t?void 0:t.metricId],value:[null==t?void 0:t.value,[s.u.required]],metricName:null==t?void 0:t.metricName,metricUnit:null==t?void 0:t.metricUnit});l.push(e)}),r.addControl("metricValues",l),i.push(r)}),e.addControl("repetitions",i),this.habits.push(e)}),this.isPrefilled=!0,this.viewReady=null===(e=this.habitStacks)||void 0===e?void 0:e.map((t,e)=>{var i;return null===(i=t.progressions)||void 0===i?void 0:i.map((t,i)=>{var n,c,a;return(null===(c=null===(n=t.repetition)||void 0===n?void 0:n.metrics)||void 0===c?void 0:c.length)==(null===(a=this.metricValues(e,i))||void 0===a?void 0:a.length)}).reduce((t,e)=>t&&e)}).reduce((t,e)=>t&&e))}initEditContent(){this.habitStacks.forEach(t=>{const e=[];t.progressions.forEach(t=>{e.push(!1)}),this.editContent.push(e)}),this.editContentPrefilled=!0}}return t.\u0275fac=function(e){return new(e||t)(c.Sb(d.a),c.Sb(m.a),c.Sb(s.d),c.Sb(g),c.Sb(f.a),c.Sb(x),c.Sb(F.a),c.Sb(I.a),c.Sb(a.a),c.Sb(r.d))},t.\u0275cmp=c.Mb({type:t,selectors:[["app-habit-stacks-list"]],decls:1,vars:1,consts:[[3,"formGroup",4,"ngIf"],[3,"formGroup"],["class","mb-3","formArrayName","habits",4,"ngFor","ngForOf"],["formArrayName","habits",1,"mb-3"],[3,"formGroupName"],["appClickStopPropagation","",1,"text-white"],["mat-icon-button","",3,"matMenuTriggerFor"],[1,"text-muted"],["menu","matMenu"],["mat-menu-item","",3,"click"],["formArrayName","repetitions"],["class","mat-elevation-z0",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"mat-elevation-z0"],["appClickStopPropagation","",1,"font-size-6"],["mat-icon-button","","class","float-right align-with-pre","appClickStopPropagation","",3,"matMenuTriggerFor",4,"ngIf"],["appClickStopPropagation",""],["class","mx-3 mb-4 roboto without-tab font-size-6 mat-emphasis-high",3,"ngClass",4,"ngIf"],["class","d-flex flex-wrap mt-3",4,"ngIf"],["class","mb-3",3,"ngClass",4,"ngIf"],["class","my-3",4,"ngIf"],["class","my-3 d-flex justify-content-center align-items-center",4,"ngIf"],["class","mb-3 text-center rounded w-100 mx-auto",4,"ngIf"],["multi",""],["class","mat-elevation-z0",4,"ngIf"],["class","mat-elevation-z0","disabled","",4,"ngIf"],["mat-button",""],["class","align-with-icon-subtitle","appClickStopPropagation","",4,"ngIf"],["appClickStopPropagation","",1,"mx-2"],["appClickStopPropagation","",1,"align-with-icon-subtitle"],["class","d-inline-block","appClickStopPropagation","",4,"ngIf"],["appClickStopPropagation","",1,"d-inline-block"],["appClickStopPropagation","",1,"mr-1"],["mat-icon-button","","appClickStopPropagation","",1,"float-right","align-with-pre",3,"matMenuTriggerFor"],[1,"mx-3","mb-4","roboto","without-tab","font-size-6","mat-emphasis-high",3,"ngClass"],[1,"d-flex","flex-wrap","mt-3"],[1,"mr-4","mb-3","mb-sm-0","d-flex","align-items-center"],["formControlName","repetitionStatus",1,"ml-3","ml-sm-5","ml-md-3","ml-lg-5"],["formArrayName","metricValues",4,"ngFor","ngForOf"],["formArrayName","metricValues"],["appearance","outline","appClickStopPropagation","",1,"suffixAlignment","mr-3",3,"formGroupName"],["matInput","","formControlName","value"],["matSuffix",""],[1,"mb-3",3,"ngClass"],["formControlName","repetitionStatus",1,"ml-5"],[1,"my-3"],[3,"pictures","publicationId","isRepetitionType","habitIndex","repetitionIndex",4,"ngIf"],[3,"pictures","publicationId","isRepetitionType","habitIndex","repetitionIndex"],[1,"my-3","d-flex","justify-content-center","align-items-center"],[3,"publicationId","headlinePicture","isRepetitionType","habitIndex","repetitionIndex"],[1,"mb-3","text-center","rounded","w-100","mx-auto"],["floatLabel","Commentaire","appearance","outline","appClickStopPropagation","",1,"w-100","mx-auto",3,"ngClass"],["matInput","","formControlName","content"],[1,"d-flex","justify-content-center","align-item-center"],["type","submit","mat-raised-button","","appClickStopPropagation","",3,"disabled","ngClass","click"],[1,"mr-2"],[1,"align-with-icon"],["disabled","",1,"mat-elevation-z0"],["class","align-with-icon",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["mat-list-icon",""],["mat-line",""]],template:function(t,e){1&t&&c.Oc(0,Lt,2,2,"form",0),2&t&&c.vc("ngIf",e.habitStacks&&e.habitStacks.length&&e.habitsForm&&e.isPrefilled&&e.editContentPrefilled&&e.viewReady)},directives:[X.m,s.w,s.p,s.h,X.l,s.c,Y.a,s.i,Y.e,Y.h,k.a,y.a,C.d,w.a,C.a,C.b,Y.d,O.a,Y.b,Y.g,X.k,P.a,T,s.o,s.g,z.c,z.g,E.a,s.b,z.i,z.b,V,it,O.c,O.d,O.e,nt.a,nt.c,nt.b,ct.f,at.a],pipes:[r.c,X.e],styles:[".align-with-icon[_ngcontent-%COMP%]{position:relative;bottom:-.1rem!important}.align-with-icon-subtitle[_ngcontent-%COMP%]{position:relative;bottom:.4rem!important}.align-checkbox[_ngcontent-%COMP%]{position:relative;bottom:-1rem}.align-with-pre[_ngcontent-%COMP%]{position:relative;bottom:.67rem}.without-tab[_ngcontent-%COMP%]{white-space:pre-line}"]}),t})(),jt=(()=>{class t{constructor(t,e){this.translationService=t,this.translate=e}ngOnInit(){this.updateLang()}ngOnDestroy(){this.langSub.unsubscribe()}updateLang(){this.translate.setDefaultLang(this.translationService.defaultLang),this.langSub=this.translationService.currentLang$.subscribe(t=>this.translate.use(t))}}return t.\u0275fac=function(e){return new(e||t)(c.Sb(a.a),c.Sb(r.d))},t.\u0275cmp=c.Mb({type:t,selectors:[["app-feedbuzz"]],decls:1,vars:0,template:function(t,e){1&t&&c.Tb(0,"app-habit-stacks-list")},directives:[Mt],styles:[""]}),t})();var Dt=i("tyNb");const _t=[{path:"",component:jt}];let Vt=(()=>{class t{}return t.\u0275mod=c.Qb({type:t}),t.\u0275inj=c.Pb({factory:function(e){return new(e||t)},imports:[[Dt.c.forChild(_t)],Dt.c]}),t})(),At=(()=>{class t{}return t.\u0275mod=c.Qb({type:t}),t.\u0275inj=c.Pb({factory:function(e){return new(e||t)},imports:[[n.a,Vt]]}),t})()}}]);